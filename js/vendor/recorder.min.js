!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Recorder=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=a("./recorder").Recorder},{"./recorder":2}],2:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{default:a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0}),c.Recorder=void 0;var e=a("inline-worker"),f=g(e),i=c.Recorder=function(){function a(b,c){var d=this;h(this,a),this.config={bufferLen:4096,numChannels:2,mimeType:"audio/wav"},this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},Object.assign(this.config,c),this.context=b.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=function(a){if(d.recording){for(var b=[],c=0;c<d.config.numChannels;c++)b.push(a.inputBuffer.getChannelData(c));d.worker.postMessage({command:"record",buffer:b})}},b.connect(this.node),this.node.connect(this.context.destination);var e={};this.worker=new f.default(function(){function f(a){c=a.sampleRate,d=a.numChannels,k()}function g(c){for(var e=0;e<d;e++)b[e].push(c[e]);a+=c[0].length}function h(c){for(var f=[],g=0;g<d;g++)f.push(l(b[g],a));var h=void 0;h=2===d?m(f[0],f[1]):f[0];var i=p(h),j=new Blob([i],{type:c});e.postMessage({command:"exportWAV",data:j})}function i(){for(var c=[],f=0;f<d;f++)c.push(l(b[f],a));e.postMessage({command:"getBuffer",data:c})}function j(){a=0,b=[],k()}function k(){for(var a=0;a<d;a++)b[a]=[]}function l(a,b){for(var c=new Float32Array(b),d=0,e=0;e<a.length;e++)c.set(a[e],d),d+=a[e].length;return c}function m(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;e<c;)d[e++]=a[f],d[e++]=b[f],f++;return d}function n(a,b,c){for(var d=0;d<c.length;d++,b+=2){var e=Math.max(-1,Math.min(1,c[d]));a.setInt16(b,e<0?32768*e:32767*e,!0)}}function o(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}function p(a){var b=new ArrayBuffer(44+2*a.length),e=new DataView(b);return o(e,0,"RIFF"),e.setUint32(4,36+2*a.length,!0),o(e,8,"WAVE"),o(e,12,"fmt "),e.setUint32(16,16,!0),e.setUint16(20,1,!0),e.setUint16(22,d,!0),e.setUint32(24,c,!0),e.setUint32(28,4*c,!0),e.setUint16(32,2*d,!0),e.setUint16(34,16,!0),o(e,36,"data"),e.setUint32(40,2*a.length,!0),n(e,44,a),e}var a=0,b=[],c=void 0,d=void 0;e.onmessage=function(a){switch(a.data.command){case"init":f(a.data.config);break;case"record":g(a.data.buffer);break;case"exportWAV":h(a.data.type);break;case"getBuffer":i();break;case"clear":j()}}},e),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(a){var b=d.callbacks[a.data.command].pop();"function"==typeof b&&b(a.data.data)}}return d(a,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(b){if(!(b=b||this.config.callback))throw new Error("Callback not set");this.callbacks.getBuffer.push(b),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(b,c){if(c=c||this.config.mimeType,!(b=b||this.config.callback))throw new Error("Callback not set");this.callbacks.exportWAV.push(b),this.worker.postMessage({command:"exportWAV",type:c})}}],[{key:"forceDownload",value:function(b,c){var d=(window.URL||window.webkitURL).createObjectURL(b),e=window.document.createElement("a");e.href=d,e.download=c||"output.wav";var f=document.createEvent("Event");f.initEvent("click",!0,!0),e.dispatchEvent(f)}}]),a}();c.default=i},{"inline-worker":3}],3:[function(a,b,c){"use strict";b.exports=a("./inline-worker")},{"./inline-worker":4}],4:[function(a,b,c){(function(a){"use strict";var c=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},e=!!(a===a.window&&a.URL&&a.Blob&&a.Worker),f=function(){function b(c,f){var g=this;if(d(this,b),e){var h=c.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],i=a.URL.createObjectURL(new a.Blob([h],{type:"text/javascript"}));return new a.Worker(i)}this.self=f,this.self.postMessage=function(a){setTimeout(function(){g.onmessage({data:a})},0)},setTimeout(function(){c.call(f)},0)}return c(b,{postMessage:{value:function(b){var c=this;setTimeout(function(){c.self.onmessage({data:b})},0)}}}),b}();b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});